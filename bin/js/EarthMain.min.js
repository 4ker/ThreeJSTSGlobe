var kurst;(function(a){(function(f){var e=(function(){function g(){this.str="mr.doob / https://github.com/mrdoob/eventdispatcher.js/"}return g})();var d=(function(){function g(){this.listeners=new Array()}g.prototype.addEventListener=function(h,i){if(this.listeners[h]===undefined){this.listeners[h]=new Array()}if(this.listeners[h].indexOf(i)===-1){this.listeners[h].push(i)}};g.prototype.removeEventListener=function(i,j){var h=this.listeners[i].indexOf(j);if(h!==-1){this.listeners[i].splice(h,1)}};g.prototype.dispatchEvent=function(m){var h=this.listeners[m.type];if(h!==undefined){this.lFncLength=h.length;m.target=this;for(var k=0,j=this.lFncLength;k<j;k++){h[k].call(this,m)}}};return g})();f.EventDispatcher=d;var c=(function(){function g(h){this.type=h}return g})();f.Event=c})(a.event||(a.event={}));var b=a.event})(kurst||(kurst={}));var __extends=this.__extends||function(e,a){function c(){this.constructor=e}c.prototype=a.prototype;e.prototype=new c()};var kurst;(function(b){(function(c){var f=(function(){function h(){}return h})();var e=(function(){function h(){this.NONE=-1;this.ROTATE=0;this.ZOOM=1;this.PAN=2;this.TOUCH_ROTATE=3;this.TOUCH_ZOOM=4;this.TOUCH_PAN=5}return h})();c.OrbitControlsState=e;var d=(function(){function h(){this.LEFT=37;this.UP=38;this.RIGHT=39;this.BOTTOM=40}return h})();c.OrbitControlsKeys=d;var g=(function(i){__extends(h,i);function h(j,k){var l=this;i.call(this);this.center=new THREE.Vector3();this.userZoom=true;this.userZoomSpeed=1;this.userRotate=true;this.userRotateSpeed=1;this.userPan=true;this.userPanSpeed=2;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minDistance=0;this.maxDistance=Infinity;this.keys=new d();this.EPS=0.000001;this.PIXELS_PER_ROUND=1800;this.rotateStart=new THREE.Vector2();this.rotateEnd=new THREE.Vector2();this.rotateDelta=new THREE.Vector2();this.zoomStart=new THREE.Vector2();this.zoomEnd=new THREE.Vector2();this.zoomDelta=new THREE.Vector2();this.phiDelta=0;this.thetaDelta=0;this.scale=1;this.lastPosition=new THREE.Vector3();this.STATE=new e();this.changeEvent=new b.event.Event("change");this.domElement=(k!==undefined)?k:document;this.state=this.STATE.NONE;this.object=j;this.onMouseMoveFnc=function(m){l.onMouseMove(m)};this.onMouseUpFnc=function(m){l.onMouseUp(m)};this.onMouseDownFnc=function(m){l.onMouseDown(m)};this.onMouseWheelFnc=function(m){l.onMouseWheel(m)};this.onKeyDownFnc=function(m){l.onKeyDown(m)};this.domElement.addEventListener("contextmenu",function(m){m.preventDefault()},false);this.domElement.addEventListener("mousedown",this.onMouseDownFnc,false);this.domElement.addEventListener("mousewheel",this.onMouseWheelFnc,false);this.domElement.addEventListener("DOMMouseScroll",this.onMouseWheelFnc,false);this.domElement.addEventListener("keydown",this.onKeyDownFnc,false)}h.prototype.rotateLeft=function(j){if(j===undefined){j=this.getAutoRotationAngle()}this.thetaDelta-=j};h.prototype.rotateRight=function(j){if(j===undefined){j=this.getAutoRotationAngle()}this.thetaDelta+=j};h.prototype.rotateUp=function(j){if(j===undefined){j=this.getAutoRotationAngle()}this.phiDelta-=j};h.prototype.rotateDown=function(j){if(j===undefined){j=this.getAutoRotationAngle()}this.phiDelta+=j};h.prototype.zoomIn=function(j){if(j===undefined){j=this.getZoomScale()}this.scale/=j};h.prototype.zoomOut=function(j){if(j===undefined){j=this.getZoomScale()}this.scale*=j};h.prototype.pan=function(j){j.transformDirection(this.object.matrix);j.multiplyScalar(this.userPanSpeed);this.object.position.add(j);this.center.add(j)};h.prototype.update=function(){var k=this.object.position;var n=k.clone().sub(this.center);var l=Math.atan2(n.x,n.z);var m=Math.atan2(Math.sqrt(n.x*n.x+n.z*n.z),n.y);if(this.autoRotate){this.rotateLeft(this.getAutoRotationAngle())}l+=this.thetaDelta;m+=this.phiDelta;m=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,m));m=Math.max(this.EPS,Math.min(Math.PI-this.EPS,m));var j=n.length()*this.scale;j=Math.max(this.minDistance,Math.min(this.maxDistance,j));n.x=j*Math.sin(m)*Math.sin(l);n.y=j*Math.cos(m);n.z=j*Math.sin(m)*Math.cos(l);k.copy(this.center).add(n);this.object.lookAt(this.center);this.thetaDelta=0;this.phiDelta=0;this.scale=1;if(this.lastPosition.distanceTo(this.object.position)>0){this.dispatchEvent(this.changeEvent);this.lastPosition.copy(this.object.position)}};h.prototype.getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed};h.prototype.getZoomScale=function(){return Math.pow(0.95,this.userZoomSpeed)};h.prototype.onMouseDown=function(j){if(!this.userRotate){return}j.preventDefault();if(j.button===0){this.state=this.STATE.ROTATE;this.rotateStart.set(j.clientX,j.clientY)}else{if(j.button===1){this.state=this.STATE.ZOOM;this.zoomStart.set(j.clientX,j.clientY)}else{if(j.button===2){this.state=this.STATE.PAN}}}document.addEventListener("mousemove",this.onMouseMoveFnc,false);document.addEventListener("mouseup",this.onMouseUpFnc,false)};h.prototype.onMouseMove=function(k){k.preventDefault();if(this.state===this.STATE.ROTATE){this.rotateEnd.set(k.clientX,k.clientY);this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.PIXELS_PER_ROUND*this.userRotateSpeed);this.rotateUp(2*Math.PI*this.rotateDelta.y/this.PIXELS_PER_ROUND*this.userRotateSpeed);this.rotateStart.copy(this.rotateEnd)}else{if(this.state===this.STATE.ZOOM){this.zoomEnd.set(k.clientX,k.clientY);this.zoomDelta.subVectors(this.zoomEnd,this.zoomStart);if(this.zoomDelta.y>0){this.zoomIn()}else{this.zoomOut()}this.zoomStart.copy(this.zoomEnd)}else{if(this.state===this.STATE.PAN){var l=k.movementX||k.mozMovementX||k.webkitMovementX||0;var j=k.movementY||k.mozMovementY||k.webkitMovementY||0;this.pan(new THREE.Vector3(-l,j,0))}}}};h.prototype.onMouseUp=function(j){if(!this.userRotate){return}document.removeEventListener("mousemove",this.onMouseMoveFnc,false);document.removeEventListener("mouseup",this.onMouseUpFnc,false);this.state=this.STATE.NONE};h.prototype.onMouseWheel=function(j){if(!this.userZoom){return}var k=0;if(j.wheelDelta){k=j.wheelDelta}else{if(j.detail){k=-j.detail}}if(k>0){this.zoomOut()}else{this.zoomIn()}};h.prototype.onKeyDown=function(j){if(!this.userPan){return}switch(j.keyCode){case this.keys.UP:this.pan(new THREE.Vector3(0,1,0));break;case this.keys.BOTTOM:this.pan(new THREE.Vector3(0,-1,0));break;case this.keys.LEFT:this.pan(new THREE.Vector3(-1,0,0));break;case this.keys.RIGHT:this.pan(new THREE.Vector3(1,0,0));break}};return h})(b.event.EventDispatcher);c.OrbitControls=g})(b.threejs||(b.threejs={}));var a=b.threejs})(kurst||(kurst={}));var kurst;(function(a){(function(d){var c=(function(f){__extends(e,f);function e(){f.call(this);this.LOAD_SUCCESS=new a.event.Event("JSonLoader_loaded");this.LOAD_ERROR=new a.event.Event("JSonLoader_loaderror");this.loader=new XMLHttpRequest()}e.prototype.loadJson=function(h){if(!this.loader){this.loader=new XMLHttpRequest()}var g=this;this.loader.open("GET",h,true);this.loader.onload=function(i){g.onLoadComplete(i)};this.loader.onerror=function(i){g.onLoadError(i)};this.loader.responseType="text";this.loader.send()};e.prototype.getData=function(){return this.jsonData};e.prototype.getJSONString=function(){return this.jsonString};e.prototype.onLoadComplete=function(g){var i=g.currentTarget;try{this.jsonData=JSON.parse(i.responseText);this.jsonString=i.responseText;this.dispatchEvent(this.LOAD_SUCCESS)}catch(h){this.jsonString=i.responseText;this.dispatchEvent(this.LOAD_ERROR)}};e.prototype.onLoadError=function(g){var h=g.currentTarget;h.abort();this.dispatchEvent(this.LOAD_ERROR)};return e})(a.event.EventDispatcher);d.JSonLoader=c})(a.data||(a.data={}));var b=a.data})(kurst||(kurst={}));var kurst;(function(a){(function(d){var c=(function(){function e(){}return e})();d.GeoData=c})(a.data||(a.data={}));var b=a.data})(kurst||(kurst={}));var kurst;(function(b){(function(c){var d=(function(){function f(){this.authorA="alteredq / http://alteredqualia.com/";this.authorB="mr.doob / http://mrdoob.com/";this.authorC="Karim Beyrouti / http://kurst.co.uk ( typescript conversion )"}return f})();var e=(function(){function f(){this.canvas=!!this.createCanvas();this.webgl=this.testWebGlRenderingContext();this.workers=!!window.Worker;this.fileAPI=!!(window.File&&window.FileReader&&window.FileList&&window.Blob)}f.prototype.addGetWebGLMessage=function(i){var h,j,g;i=i||{};h=i.parent!==undefined?i.parent:document.body;j=i.id!==undefined?i.id:"oldie";g=this.getWebGLErrorMessage();g.id=j;h.appendChild(g)};f.prototype.getWebGLErrorMessage=function(){var g=document.createElement("div");g.id="webgl-error-message2";g.style.fontFamily="monospace";g.style.fontSize="13px";g.style.fontWeight="normal";g.style.textAlign="center";g.style.background="#fff";g.style.color="#000";g.style.padding="1.5em";g.style.width="400px";g.style.margin="5em auto 0";g.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n");return g};f.prototype.testWebGlRenderingContext=function(){try{var g=!!this.createCanvas().getContext("experimental-webgl");var h=!!this.createCanvas().getContext("webgl");return g||h}catch(i){return false}};f.prototype.createCanvas=function(){return document.createElement("canvas")};return f})();c.Detector=e})(b.threejs||(b.threejs={}));var a=b.threejs})(kurst||(kurst={}));var kurst;(function(b){(function(c){var d=(function(){function h(){this.authorA="Eberhard Graether / http://egraether.com/";this.authorB="Karim Beyrouti / http://kurst.co.uk ( typescript conversion )"}return h})();var f=(function(){function h(){this.width=0;this.height=0;this.offsetLeft=0;this.offsetTop=0}return h})();c.TrackballControlsScreen=f;var g=(function(){function h(){this.NONE=-1;this.ROTATE=0;this.ZOOM=1;this.PAN=2;this.TOUCH_ROTATE=3;this.TOUCH_ZOOM=4;this.TOUCH_PAN=5}return h})();c.TrackballControlsState=g;var e=(function(i){__extends(h,i);function h(j,k){var l=this;i.call(this);this.enabled=true;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.wheelSpeed=0.15;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.STATE=new b.threejs.TrackballControlsState();this.screen=new b.threejs.TrackballControlsScreen();this._touchZoomDistanceStart=0;this._touchZoomDistanceEnd=0;this.changeEvent=new b.event.Event("change");this.object=j;this.domElement=(k!==undefined)?k:document;this.radius=(this.screen.width+this.screen.height)/4;this.target=new THREE.Vector3();this.lastPosition=new THREE.Vector3();this._state=this.STATE.NONE;this._prevState=this.STATE.NONE;this._eye=new THREE.Vector3(),this._rotateStart=new THREE.Vector3(),this._rotateEnd=new THREE.Vector3(),this._zoomStart=new THREE.Vector2(),this._zoomEnd=new THREE.Vector2(),this._panStart=new THREE.Vector2();this._panEnd=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();this.keys=new Array();this.mousewheelFnc=function(m){l.mousewheel(m)};this.mousedownFnc=function(m){l.mousedown(m)};this.mouseupFnc=function(m){l.mouseup(m)};this.mousemoveFnc=function(m){l.mousemove(m)};this.DOMMouseScrollFnc=function(m){l.DOMMouseScrollFnc(m)};this.touchstartFnc=function(m){l.touchstart(m)};this.touchendFnc=function(m){l.touchend(m)};this.touchmoveFnc=function(m){l.touchmove(m)};this.keydownFnc=function(m){l.keydown(m)};this.keyupFnc=function(m){l.keyup(m)};this.domElement.addEventListener("contextmenu",function(m){m.preventDefault()},false);this.domElement.addEventListener("mousedown",this.mousedownFnc,false);this.domElement.addEventListener("mousewheel",this.mousewheelFnc,false);this.domElement.addEventListener("DOMMouseScroll",this.DOMMouseScrollFnc,false);this.domElement.addEventListener("touchstart",this.touchstartFnc,false);this.domElement.addEventListener("touchend",this.touchendFnc,false);this.domElement.addEventListener("touchmove",this.touchmoveFnc,false);window.addEventListener("keydown",function(m){return l.keydown(m)},false);window.addEventListener("keyup",function(m){return l.keyup(m)},false);this.handleResize()}h.prototype.update=function(){this._eye.subVectors(this.object.position,this.target);if(!this.noRotate){this.rotateCamera()}if(!this.noZoom){this.zoomCamera()}if(!this.noPan){this.panCamera()}this.object.position.addVectors(this.target,this._eye);this.checkDistances();this.object.lookAt(this.target);if(this.lastPosition.distanceToSquared(this.object.position)>0){this.dispatchEvent(this.changeEvent);this.lastPosition.copy(this.object.position)}};h.prototype.reset=function(){this._state=this.STATE.NONE;this._prevState=this.STATE.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.up.copy(this.up0);this._eye.subVectors(this.object.position,this.target);this.object.lookAt(this.target);this.dispatchEvent(this.changeEvent);this.lastPosition.copy(this.object.position)};h.prototype.handleEvent=function(j){if(typeof this[j.type]=="function"){this[j.type](j)}};h.prototype.getMouseOnScreen=function(k,j){return new THREE.Vector2((k-this.screen.offsetLeft)/this.radius*0.5,(j-this.screen.offsetTop)/this.radius*0.5)};h.prototype.getMouseProjectionOnBall=function(n,l){var k=new THREE.Vector3((n-this.screen.width*0.5-this.screen.offsetLeft)/this.radius,(this.screen.height*0.5+this.screen.offsetTop-l)/this.radius,0);var m=k.length();if(m>1){k.normalize()}else{k.z=Math.sqrt(1-m*m)}this._eye.copy(this.object.position).sub(this.target);var j=this.object.up.clone().setLength(k.y);j.add(this.object.up.clone().cross(this._eye).setLength(k.x));j.add(this._eye.setLength(k.z));return j};h.prototype.rotateCamera=function(){var l=Math.acos(this._rotateStart.dot(this._rotateEnd)/this._rotateStart.length()/this._rotateEnd.length());if(l){var j=(new THREE.Vector3()).crossVectors(this._rotateStart,this._rotateEnd).normalize();var k=new THREE.Quaternion();l*=this.rotateSpeed;k.setFromAxisAngle(j,-l);this._eye.applyQuaternion(k);this.object.up.applyQuaternion(k);this._rotateEnd.applyQuaternion(k);if(this.staticMoving){this._rotateStart.copy(this._rotateEnd)}else{k.setFromAxisAngle(j,l*(this.dynamicDampingFactor-1));this._rotateStart.applyQuaternion(k)}}};h.prototype.zoomCamera=function(){if(this._state===this.STATE.TOUCH_ZOOM){var j=this._touchZoomDistanceStart/this._touchZoomDistanceEnd;this._touchZoomDistanceStart=this._touchZoomDistanceEnd;this._eye.multiplyScalar(j)}else{var j=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed;if(j!==1&&j>0){this._eye.multiplyScalar(j);if(this.staticMoving){this._zoomStart.copy(this._zoomEnd)}else{this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor}}}};h.prototype.panCamera=function(){var j=this._panEnd.clone().sub(this._panStart);if(j.lengthSq()){j.multiplyScalar(this._eye.length()*this.panSpeed);var k=this._eye.clone().cross(this.object.up).setLength(j.x);k.add(this.object.up.clone().setLength(j.y));this.object.position.add(k);this.target.add(k);if(this.staticMoving){this._panStart=this._panEnd}else{this._panStart.add(j.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}};h.prototype.checkDistances=function(){if(!this.noZoom||!this.noPan){if(this.object.position.lengthSq()>this.maxDistance*this.maxDistance){this.object.position.setLength(this.maxDistance)}if(this._eye.lengthSq()<this.minDistance*this.minDistance){this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance))}}};h.prototype.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};h.prototype.keydown=function(j){if(this.enabled===false){return}console.log("keyDown");this._prevState=this._state;if(this._state!==this.STATE.NONE){return}else{if(j.keyCode===this.keys[this.STATE.ROTATE]&&!this.noRotate){this._state=this.STATE.ROTATE}else{if(j.keyCode===this.keys[this.STATE.ZOOM]&&!this.noZoom){this._state=this.STATE.ZOOM}else{if(j.keyCode===this.keys[this.STATE.PAN]&&!this.noPan){this._state=this.STATE.PAN}}}}};h.prototype.keyup=function(j){if(this.enabled===false){return}this._state=this._prevState};h.prototype.mousedown=function(j){if(this.enabled===false){return}j.preventDefault();j.stopPropagation();if(this._state===this.STATE.NONE){this._state=j.button}if(this._state===this.STATE.ROTATE&&!this.noRotate){this._rotateStart=this._rotateEnd=this.getMouseProjectionOnBall(j.clientX,j.clientY)}else{if(this._state===this.STATE.ZOOM&&!this.noZoom){this._zoomStart=this._zoomEnd=this.getMouseOnScreen(j.clientX,j.clientY)}else{if(this._state===this.STATE.PAN&&!this.noPan){this._panStart=this._panEnd=this.getMouseOnScreen(j.clientX,j.clientY)}}}this.domElement.addEventListener("mousemove",this.mousemoveFnc,false);this.domElement.addEventListener("mouseup",this.mouseupFnc,false)};h.prototype.mousemove=function(j){if(this.enabled===false){return}j.preventDefault();j.stopPropagation();if(this._state===this.STATE.ROTATE&&!this.noRotate){this._rotateEnd=this.getMouseProjectionOnBall(j.clientX,j.clientY)}else{if(this._state===this.STATE.ZOOM&&!this.noZoom){this._zoomEnd=this.getMouseOnScreen(j.clientX,j.clientY)}else{if(this._state===this.STATE.PAN&&!this.noPan){this._panEnd=this.getMouseOnScreen(j.clientX,j.clientY)}}}};h.prototype.mouseup=function(j){if(this.enabled===false){return}j.preventDefault();j.stopPropagation();this._state=this.STATE.NONE;this.domElement.removeEventListener("mousemove",this.mousemoveFnc);this.domElement.removeEventListener("mouseup",this.mouseupFnc)};h.prototype.mousewheel=function(j){if(this.enabled===false){return}j.preventDefault();j.stopPropagation();var k=0;if(j.wheelDelta){k=j.wheelDelta/40}else{if(j.detail){k=-j.detail/3}}this._zoomStart.y+=(1/k)*this.wheelSpeed};h.prototype.touchstart=function(l){if(this.enabled===false){return}switch(l.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE;this._rotateStart=this._rotateEnd=this.getMouseProjectionOnBall(l.touches[0].pageX,l.touches[0].pageY);break;case 2:this._state=this.STATE.TOUCH_ZOOM;var k=l.touches[0].pageX-l.touches[1].pageX;var j=l.touches[0].pageY-l.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(k*k+j*j);break;case 3:this._state=this.STATE.TOUCH_PAN;this._panStart=this._panEnd=this.getMouseOnScreen(l.touches[0].pageX,l.touches[0].pageY);break;default:this._state=this.STATE.NONE}};h.prototype.touchmove=function(l){if(this.enabled===false){return}l.preventDefault();l.stopPropagation();switch(l.touches.length){case 1:this._rotateEnd=this.getMouseProjectionOnBall(l.touches[0].pageX,l.touches[0].pageY);break;case 2:var k=l.touches[0].pageX-l.touches[1].pageX;var j=l.touches[0].pageY-l.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(k*k+j*j);break;case 3:this._panEnd=this.getMouseOnScreen(l.touches[0].pageX,l.touches[0].pageY);break;default:this._state=this.STATE.NONE}};h.prototype.touchend=function(j){if(this.enabled===false){return}switch(j.touches.length){case 1:this._rotateStart=this._rotateEnd=this.getMouseProjectionOnBall(j.touches[0].pageX,j.touches[0].pageY);break;case 2:this._touchZoomDistanceStart=this._touchZoomDistanceEnd=0;break;case 3:this._panStart=this._panEnd=this.getMouseOnScreen(j.touches[0].pageX,j.touches[0].pageY);break}this._state=this.STATE.NONE};return h})(b.event.EventDispatcher);c.TrackballControls=e})(b.threejs||(b.threejs={}));var a=b.threejs})(kurst||(kurst={}));var kurst;(function(b){(function(c){var d=(function(f){__extends(e,f);function e(){var g=this;f.call(this);this.clearColor=0;this.trackControlEnabled=false;this.renderFlag=false;this.resizeEvent=new b.event.Event("resize");this.initThreeJSWebGLView();window.addEventListener("resize",function(h){return g.onWindowResize(h)},false)}e.prototype.enableTrackBall=function(g){if(g){this.trackControls=new b.threejs.TrackballControls(this.camera);this.trackControls.rotateSpeed=1;this.trackControls.zoomSpeed=1.2;this.trackControls.panSpeed=0.8;this.trackControls.noZoom=false;this.trackControls.noPan=true;this.trackControls.staticMoving=false;this.trackControls.dynamicDampingFactor=0.1;this.trackControls.zoomSpeed=0.45;this.trackControls.addEventListener("change",this.controlChange)}this.trackControlEnabled=g};e.prototype.render=function(){if(this.trackControlEnabled){if(this.trackControls){this.trackControls.update()}}this.renderer.render(this.scene,this.camera)};e.prototype.startRender=function(){var h=this;this.renderFlag=true;var g=function(){h.render();if(h.renderFlag){requestAnimationFrame(g)}};requestAnimationFrame(g)};e.prototype.stopRender=function(){this.renderFlag=false};e.prototype.initThreeJSWebGLView=function(){this.detector=new b.threejs.Detector();this.initContainer();this.initScene();this.initRenderer();this.initCamera()};e.prototype.initContainer=function(){this.container=document.createElement("div");document.body.appendChild(this.container)};e.prototype.initScene=function(){this.scene=new THREE.Scene()};e.prototype.initRenderer=function(){this.renderer=new THREE.WebGLRenderer({antialias:true,clearColor:this.clearColor});this.renderer.sortObjects=false;this.renderer.setSize(window.innerWidth,window.innerHeight);this.container.appendChild(this.renderer.domElement)};e.prototype.initCamera=function(){this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,20000);this.camera.position.z=1000};e.prototype.onWindowResize=function(g){this.camera.aspect=window.innerWidth/window.innerHeight;this.camera.updateProjectionMatrix();this.renderer.setSize(window.innerWidth,window.innerHeight);this.dispatchEvent(this.resizeEvent)};e.prototype.controlChange=function(){};return e})(b.event.EventDispatcher);c.ThreeJSWebGLView=d})(b.threejs||(b.threejs={}));var a=b.threejs})(kurst||(kurst={}));var apps;(function(a){(function(d){(function(f){var g=(function(){function h(){this.normalScale=2.5;this.radius=200}return h})();f.EarthSettings=g;var e=(function(i){__extends(h,i);function h(k,j){i.call(this);this.earthSettings=j;this.scene=k;this.initEarth();this.initClouds()}h.prototype.initClouds=function(){this.cloudsTexture=THREE.ImageUtils.loadTexture(this.earthSettings.cloudsMap);this.cloudsMaterial=new THREE.MeshLambertMaterial({ambient:12303291,map:this.cloudsTexture,side:THREE.DoubleSide});this.cloudsMaterial.transparent=true;this.cloudsMaterial.opacity=0.9;this.cloudsGeom=new THREE.SphereGeometry(this.earthSettings.radius+2,30,30);this.cloudsMesh=new THREE.Mesh(this.cloudsGeom,this.cloudsMaterial);this.cloudsMesh.castShadow=true;this.cloudsMesh.receiveShadow=true;this.container.add(this.cloudsMesh)};h.prototype.initEarth=function(){var k=THREE.ImageUtils.loadTexture(this.earthSettings.earthNormal);var l=THREE.ImageUtils.loadTexture(this.earthSettings.earthMap);var k=THREE.ImageUtils.loadTexture(this.earthSettings.earthNormal);var l=THREE.ImageUtils.loadTexture(this.earthSettings.earthMap);var m=THREE.ShaderLib.normalmap;var j=THREE.UniformsUtils.clone(m.uniforms);j.enableAO.value=false;j.enableDiffuse.value=true;j.enableSpecular.value=true;j.enableReflection.value=false;j.enableDisplacement.value=false;j.tNormal.value=k;j.tDiffuse.value=l;j.tSpecular.value=l;j.uNormalScale.value.set(this.earthSettings.normalScale,this.earthSettings.normalScale);this.earthNormal=new THREE.ShaderMaterial({fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:j,lights:true,fog:false});this.earthMeshMat=new THREE.MeshBasicMaterial({color:16777215,wireframe:true,transparent:true,opacity:0.02,side:THREE.DoubleSide});this.materials=[];this.materials.push(this.earthNormal);this.materials.push(this.earthMeshMat);this.earthGeom=new THREE.SphereGeometry(this.earthSettings.radius,40,30);this.earthGeom.computeTangents();this.earth=THREE.SceneUtils.createMultiMaterialObject(this.earthGeom,this.materials);this.earth.position.set(0,0,0);this.earth.castShadow=true;this.earth.receiveShadow=true;this.container=new THREE.Object3D();this.container.add(this.earth);this.scene.add(this.container)};h.prototype.render=function(){this.cloudsMesh.rotation.y+=0.0001};return h})(kurst.event.EventDispatcher);f.Earth=e})(d.assets||(d.assets={}));var c=d.assets})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var apps;(function(a){(function(d){(function(e){var f=(function(){function g(j,k){this.globeView=j;this.atmosphereMaterial=new THREE.ShaderMaterial({uniforms:{c:{type:"f",value:0.4},p:{type:"f",value:5}},vertexShader:["varying vec3 vNormal;","void main(){","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float c;","uniform float p;","varying vec3 vNormal;","void main(){","float intensity = pow( c - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), p );","gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 ) * intensity;","}"].join("\n")});this.scene=new THREE.Scene();this.camera=new THREE.PerspectiveCamera(j.camera.fov,window.innerWidth/window.innerHeight,1,20000);this.camera.position=j.camera.position;this.camera.rotation=j.camera.rotation;this.scene.add(this.camera);this.atmosphereMesh=new THREE.Mesh(k.clone(),this.atmosphereMaterial);this.atmosphereMesh.scale.x=this.atmosphereMesh.scale.y=this.atmosphereMesh.scale.z=1.2;this.atmosphereMesh.material.side=THREE.BackSide;this.scene.add(this.atmosphereMesh);var l=new THREE.MeshBasicMaterial({color:0});var h=new THREE.Mesh(k.clone(),l);h.scale.x=h.scale.y=h.scale.z=1;this.scene.add(h);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,i);this.composer2=new THREE.EffectComposer(j.renderer,this.renderTarget);this.render2Pass=new THREE.RenderPass(this.scene,this.camera);this.composer2.addPass(this.render2Pass);this.finalComposer=new THREE.EffectComposer(j.renderer,this.renderTarget);this.renderModel=new THREE.RenderPass(j.scene,j.camera);this.finalComposer.addPass(this.renderModel);this.effectBlend=new THREE.ShaderPass(THREE.AdditiveBlendShader,"tDiffuse1");this.effectBlend.uniforms.tDiffuse2.value=this.composer2.renderTarget2;this.effectBlend.renderToScreen=true;this.finalComposer.addPass(this.effectBlend);j.renderer.autoClear=false;j.renderer.setClearColorHex(0,0)}g.prototype.resize=function(){this.camera.aspect=window.innerWidth/window.innerHeight;this.camera.updateProjectionMatrix();this.renderTarget.width=window.innerWidth;this.renderTarget.height=window.innerHeight};g.prototype.render=function(){this.composer2.render();this.finalComposer.render()};return g})();e.Atmosphere=f})(d.assets||(d.assets={}));var c=d.assets})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var apps;(function(a){(function(d){(function(g){var e=(function(){function h(){this.size=4000}return h})();g.SkyboxData=e;var f=(function(i){__extends(h,i);function h(k,j){i.call(this);this.data=j;this.scene=k;this.init()}h.prototype.init=function(){var k=[this.data.path+this.data.posx+this.data.format,this.data.path+this.data.negx+this.data.format,this.data.path+this.data.posy+this.data.format,this.data.path+this.data.negy+this.data.format,this.data.path+this.data.posz+this.data.format,this.data.path+this.data.negz+this.data.format];this.textureCube=THREE.ImageUtils.loadTextureCube(k);var j=THREE.ShaderLib.cube;j.uniforms.tCube.value=this.textureCube;this.materialCube=new THREE.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:j.uniforms,depthWrite:false,side:THREE.BackSide});this.cubeGeom=new THREE.CubeGeometry(this.data.size,this.data.size,this.data.size);this.cubeMesh=new THREE.Mesh(this.cubeGeom,this.materialCube);this.scene.add(this.cubeMesh)};return h})(kurst.event.EventDispatcher);g.Skybox=f})(d.assets||(d.assets={}));var c=d.assets})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var apps;(function(a){(function(d){(function(f){var e=(function(){function h(){this.fieldWidth=3800;this.fieldHeight=3800;this.fieldDepth=3800;this.excludeBounds=400;this.opacity=0.35;this.size=1;this.numParticles=4000}return h})();f.StarFieldData=e;var g=(function(h){__extends(i,h);function i(k,j){h.call(this);if(j===undefined){j=new a.globe.assets.StarFieldData()}this.data=j;this.scene=k;this.init()}i.prototype.init=function(){this.geometry=new THREE.Geometry();var l=this.data.fieldWidth;var k=this.data.fieldHeight;var p=this.data.fieldDepth;var j=this.data.excludeBounds;for(var m=0;m<this.data.numParticles;m++){var s=Math.random()*l-l/2;var r=Math.random()*k-k/2;var q=Math.random()*p-p/2;var o=Math.sqrt(s*s+r*r+q*q);if(o>j){var n=new THREE.Vector3();n.x=s;n.y=r;n.z=q;this.geometry.vertices.push(n)}}this.particleMat=new THREE.ParticleBasicMaterial({size:this.data.size});this.particleMat.color.setRGB(25,25,25);this.particleMat.opacity=this.data.opacity;this.particleMat.transparent=true;this.particles=new THREE.ParticleSystem(this.geometry,this.particleMat);this.scene.add(this.particles)};return i})(kurst.event.EventDispatcher);f.StarField=g})(d.assets||(d.assets={}));var c=d.assets})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var kurst;(function(b){(function(c){var d=(function(){function e(){}e.isFireFox=function h(){return(navigator.userAgent.search("Firefox")!=-1)};e.isIE=function g(){return(navigator.appVersion.indexOf("MSIE")!=-1)};e.getIEVersion=function i(){if(e.isIE()){return parseFloat(navigator.appVersion.split("MSIE")[1])}return -1};e.isFlashEnabled=function f(){if(e.isIE()){var j=e.getIEVersion();if(j>8){return(window.ActiveXObject&&(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))!=false)}else{try{var k=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(k){return true}return false}catch(l){return false}}return false}else{return((typeof navigator.plugins!="undefined"&&typeof navigator.plugins["Shockwave Flash"]=="object")!=false)}};return e})();c.JSUtils=d})(b.utils||(b.utils={}));var a=b.utils})(kurst||(kurst={}));var apps;(function(a){(function(d){(function(g){var f=(function(){function h(){this.textureFlare="media/textures/flare/bright-sun.png";this.textureFlare10="media/textures/flare/flare10.jpg";this.textureFlare11="media/textures/flare/flare11.jpg";this.textureFlare7="media/textures/flare/flare7.jpg";this.textureFlare12="media/textures/flare/flare12.jpg";this.textureFlare6="media/textures/flare/flare6.jpg";this.textureFlare2="media/textures/flare/flare2.jpg";this.textureFlare3="media/textures/flare/flare3.jpg";this.textureFlare4="media/textures/flare/flare4.jpg";this.textureFlare8="media/textures/flare/flare8.jpg";this.sunMap="media/textures/flare/sunmap.png";this.enableFlare=true}return h})();g.SunData=f;var e=(function(i){__extends(h,i);function h(l,j,k){i.call(this);if(k===undefined){k=new a.globe.assets.SunData()}this.sunData=k;this.scene=l;this.light=j;if(!kurst.utils.JSUtils.isFireFox()){if(this.sunData.enableFlare){this.initFlare()}}this.initSun()}h.prototype.initFlare=function(){var o=THREE.ImageUtils.loadTexture(this.sunData.textureFlare);var n=THREE.ImageUtils.loadTexture(this.sunData.textureFlare10);var m=THREE.ImageUtils.loadTexture(this.sunData.textureFlare11);var r=THREE.ImageUtils.loadTexture(this.sunData.textureFlare7);var l=THREE.ImageUtils.loadTexture(this.sunData.textureFlare12);var s=THREE.ImageUtils.loadTexture(this.sunData.textureFlare6);var k=THREE.ImageUtils.loadTexture(this.sunData.textureFlare2);var u=THREE.ImageUtils.loadTexture(this.sunData.textureFlare3);var t=THREE.ImageUtils.loadTexture(this.sunData.textureFlare4);var q=THREE.ImageUtils.loadTexture(this.sunData.textureFlare8);var j=new THREE.Color(16777215);var p=0.103;this.lensFlare=new THREE.LensFlare(undefined,300,0,THREE.AdditiveBlending,j);this.lensFlare.add(o,200,-0.04,THREE.AdditiveBlending,j,1);this.lensFlare.add(n,160,-0.01,THREE.AdditiveBlending,j,p);this.lensFlare.add(m,460,0,THREE.AdditiveBlending,j,p);this.lensFlare.add(r,360,0,THREE.AdditiveBlending,j,p);this.lensFlare.add(l,100,0.1,THREE.AdditiveBlending,j,p);this.lensFlare.add(l,50,0.2,THREE.AdditiveBlending,j,p);this.lensFlare.add(k,250,0.3,THREE.AdditiveBlending,j,p);this.lensFlare.add(s,150,0.58,THREE.AdditiveBlending,j,p);this.lensFlare.add(u,175,0.7,THREE.AdditiveBlending,j,p);this.lensFlare.add(t,240,0.8,THREE.AdditiveBlending,j,p);this.lensFlare.add(q,100,0.9,THREE.AdditiveBlending,j,p);this.lensFlare.add(s,350,1,THREE.AdditiveBlending,j,p);this.lensFlare.add(r,650,1.5,THREE.AdditiveBlending,j,p);this.lensFlare.position=this.light.position;this.lensFlare.position.x-=500;this.scene.add(this.lensFlare)};h.prototype.initSun=function(){var n=THREE.ImageUtils.loadTexture(this.sunData.sunMap);var m=new THREE.MeshPhongMaterial({map:n});m.emissive=new THREE.Color(16777215);var j=new THREE.MeshLambertMaterial({map:n});j.ambient=new THREE.Color(16777215);j.blending=THREE.AdditiveBlending;var k=new THREE.SphereGeometry(140,16,16);var l=new THREE.Mesh(k,m);l.position.x=this.light.position.x+250;l.position.y=this.light.position.y;l.position.z=this.light.position.z;this.scene.add(l)};return h})(kurst.event.EventDispatcher);g.Sun=e})(d.assets||(d.assets={}));var c=d.assets})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var apps;(function(a){(function(d){(function(e){var f=(function(g){__extends(h,g);function h(i){g.call(this);this.scene=i;this.initGrid()}h.prototype.initGrid=function(){this.earthGridMat=new THREE.MeshBasicMaterial({color:16777215,wireframe:true,transparent:true,opacity:0.015});this.materials=[];this.materials.push(this.earthGridMat);this.gridGeom=new THREE.SphereGeometry(4000,60,40);this.gridGeom.computeTangents();this.gridMesh=THREE.SceneUtils.createMultiMaterialObject(this.gridGeom,this.materials);this.gridMesh.position.set(0,0,0);this.scene.add(this.gridMesh)};return h})(kurst.event.EventDispatcher);e.SkyGrid=f})(d.assets||(d.assets={}));var c=d.assets})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var apps;(function(a){(function(f){var d=(function(g){__extends(h,g);function h(){var i=this;g.call(this);this.markerCounter=0;this.markers=[];this.defaultMarker=new a.globe.MarkerSettings();this.defaultMarker.material=new THREE.MeshBasicMaterial({color:16771584});this.defaultMarker.geom=new THREE.TetrahedronGeometry(0.8,2);this.initGlobeView();this.addEventListener(this.resizeEvent.type,function(j){return i.onResizeHandler(j)})}h.prototype.addMarker=function(j,i){if(j.latitude===0||j.longitude===0||j.longitude===undefined||j.latitude===undefined){return}if(i===undefined){i=this.defaultMarker}var l=new THREE.Mesh(i.geom,i.material);l.position=this.translateGeoCoords(j.latitude,j.longitude,this.earthSettings.radius+5);l.lookAt(this.earth.container.position);var k=new e();k.id=this.markerCounter++;k.mesh=l;k.data=j;this.markers.push(k);this.earth.container.add(l)};h.prototype.translateGeoCoords=function(p,m,j){var l=(p)*Math.PI/180;var k=(m-180)*Math.PI/180;var i=-(j)*Math.cos(l)*Math.cos(k);var o=(j)*Math.sin(l);var n=(j)*Math.cos(l)*Math.sin(k);return new THREE.Vector3(i,o,n)};h.prototype.render=function(){this.earth.container.rotation.y+=0.0006;this.earth.render();this.orbitControl.update();this.renderer.render(this.scene,this.camera);if(this.composer){this.renderer.clear();this.composer.render(0.015)}if(this.atmos){this.atmos.render()}if(this.composer){this.composer.render()}};h.prototype.initGlobeView=function(){this.initLights();this.initLensFlare();this.initEarth();this.initSkybox();this.startRender();this.initStarField();this.initOrbitControls();this.initAtmosphere();this.scene.fog=new THREE.FogExp2(16777215,0.0007)};h.prototype.initAtmosphere=function(){this.atmos=new a.globe.assets.Atmosphere(this,this.earth.earthGeom)};h.prototype.initOrbitControls=function(){this.orbitControl=new kurst.threejs.OrbitControls(this.camera);this.orbitControl.autoRotate=true;this.orbitControl.autoRotateSpeed=0.15;this.orbitControl.maxDistance=2500;this.orbitControl.minDistance=600};h.prototype.initLensFlare=function(){this.sun=new a.globe.assets.Sun(this.scene,this.pointLight)};h.prototype.initSkybox=function(){var i=new a.globe.assets.SkyboxData();i.path="media/textures/skybox/";i.format=".jpg";i.posx="spacescape_right1";i.negx="spacescape_left2";i.posy="spacescape_top3";i.negy="spacescape_bottom4";i.posz="spacescape_front5";i.negz="spacescape_back6";this.skybox=new a.globe.assets.Skybox(this.scene,i);this.skyGrid=new a.globe.assets.SkyGrid(this.scene)};h.prototype.initLights=function(){this.ambientLight=new THREE.AmbientLight(4473924);this.scene.add(this.ambientLight);this.pointLight=new THREE.PointLight(16777215,3,3000);this.pointLight.lookAt(new THREE.Vector3(0,0,0));this.pointLight.position.set(2800,0,0);this.scene.add(this.pointLight)};h.prototype.initStarField=function(){this.starField=new a.globe.assets.StarField(this.scene)};h.prototype.initEarth=function(){this.earthSettings=new a.globe.assets.EarthSettings();this.earthSettings.earthMap="media/textures/earth_day.jpg";this.earthSettings.earthNight="media/textures/earth_night.jpg";this.earthSettings.earthNormal="media/textures/earth_normal.jpg";this.earthSettings.cloudsMap="media/textures/earth_clouds.png";this.earthSettings.earthAO="media/textures/earth_normal_OCC.png";this.earth=new a.globe.assets.Earth(this.scene,this.earthSettings)};h.prototype.onResizeHandler=function(i){if(this.atmos){this.atmos.resize()}};return h})(kurst.threejs.ThreeJSWebGLView);f.GlobeView=d;var c=(function(){function g(){}return g})();f.MarkerSettings=c;var e=(function(){function g(){}return g})();f.MarkerVO=e})(a.globe||(a.globe={}));var b=a.globe})(apps||(apps={}));var kurst;(function(b){(function(c){var d=(function(){function e(){}e.prototype.getId=function(f){return document.getElementById(f)};e.prototype.getClass=function(f){return document.getElementsByClassName(f)};e.prototype.getElementsByClassNme=function(n){var l=new Array();var j=document;var h=0;if(j.getElementsByClassName){var m=j.getElementsByClassName(n);for(h=0;h<m.length;h++){l.push(m[h])}}else{var k=new RegExp("\\b"+n+"\\b");var f=j.getElementsByTagName("*");for(h=0;h<f.length;h++){var g=f[h]["className"];if(k.test(g)){l.push(f[h])}}}return l};return e})();c.UIBase=d})(b.core||(b.core={}));var a=b.core})(kurst||(kurst={}));var kurst;(function(a){(function(c){var d=(function(e){__extends(f,e);function f(g){var h=this;e.call(this);this.useProxy=true;this.proxy="proxy.php";this.proxyParam="url";this.LOAD_SUCCESS=new a.event.Event("IPGeoCoder_loaded");this.LOAD_ERROR=new a.event.Event("IPGeoCoder_loadfailed");this.apikey=g;this.jsonLoader=new a.data.JSonLoader();this.jsonLoader.addEventListener(this.jsonLoader.LOAD_ERROR.type,function(i){return h.jsonLoadFail()});this.jsonLoader.addEventListener(this.jsonLoader.LOAD_SUCCESS.type,function(i){return h.jsonLoaded()})}f.prototype.locateIP=function(h){var g="http://api.ipinfodb.com/v3/ip-city/?key="+this.apikey+"&ip="+h+"&format=json";if(this.useProxy){g=this.proxy+"?"+this.proxyParam+"="+encodeURIComponent(g)}this.jsonLoader.loadJson(g)};f.prototype.enableProxy=function(g,h,i){this.useProxy=g;this.proxy=h;this.proxyParam=i};f.prototype.getLocationData=function(){return this.data};f.prototype.jsonLoaded=function(){var g=this.jsonLoader.getData();this.data=new a.data.GeoData();this.data.statusCode=g.statusCode;this.data.statusMessage=g.statusMessage;this.data.ipAddress=g.ipAddress;this.data.countryCode=g.countryCode;this.data.countryName=g.countryName;this.data.regionName=g.regionName;this.data.cityName=g.cityName;this.data.zipCode=g.zipCode;this.data.latitude=parseFloat(g.latitude);this.data.longitude=parseFloat(g.longitude);this.data.timeZone=g.timeZone;this.dispatchEvent(this.LOAD_SUCCESS)};f.prototype.jsonLoadFail=function(){this.dispatchEvent(this.LOAD_ERROR)};return f})(a.event.EventDispatcher);c.IPGeoCoder=d})(a.data||(a.data={}));var b=a.data})(kurst||(kurst={}));var kurst;(function(a){(function(c){var d=(function(e){__extends(f,e);function f(){e.call(this);this.LOAD_SUCCESS=new a.event.Event("DataSender_loaded");this.LOAD_ERROR=new a.event.Event("DataSender_loadfailed");this.loader=new XMLHttpRequest()}f.prototype.loadData=function(h){if(!this.loader){this.loader=new XMLHttpRequest()}var g=this;this.loader.open("GET",h,true);this.loader.onload=function(i){g.onLoadComplete(i)};this.loader.onerror=function(i){g.onLoadError(i)};this.loader.responseType="text";this.loader.send()};f.prototype.getData=function(){return this.data};f.prototype.onLoadComplete=function(g){var i=g.currentTarget;try{this.data=i.responseText;this.dispatchEvent(this.LOAD_SUCCESS)}catch(h){this.data=i.responseText;this.dispatchEvent(this.LOAD_ERROR)}};f.prototype.onLoadError=function(g){var h=g.currentTarget;h.abort();this.dispatchEvent(this.LOAD_ERROR)};return f})(a.event.EventDispatcher);c.DataLoader=d})(a.data||(a.data={}));var b=a.data})(kurst||(kurst={}));var kurst;(function(b){(function(c){var d=(function(){function j(){}j.get=function h(m){return j.has(m)?j.list()[m]:null};j.has=function g(n){var m=document.cookie;return new RegExp("(?:;\\s*|^)"+encodeURIComponent(n)+"=").test(m)};j.list=function k(p){var q=document.cookie.split(";"),r,n={};for(var o=0,m=q.length;o<m;++o){r=q[o].split("=");r[0]=r[0].replace(/^\s+|\s+$/,"");if(!j.isRegExp(p)||p.test(r[0])){n[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}}return n};j.set=function l(p,s,o){o=o||{};var r=[encodeURIComponent(p)+"="+encodeURIComponent(s)];if(o.path){r.push("path="+o.path)}if(o.domain){r.push("domain="+o.domain)}var n="maxAge" in o?o.maxAge:("max_age" in o?o.max_age:o["max-age"]),q;if("undefined"!=typeof n&&"null"!=typeof n&&(!isNaN(q=parseFloat(n)))){r.push("max-age="+q)}var m=j.isDate(o.expires)?o.expires.toUTCString():o.expires;if(m){r.push("expires="+m)}if(o.secure){r.push("secure")}var t=r.join(";");document.cookie=t;return r};j.remove=function f(n,m){var p={};for(var o in (m||{})){p[o]=m[o]}p.expires=new Date(0);p.maxAge=-1;return j.set(n,null,p)};j.isRegExp=function e(m){return"[object RegExp]"==Object.prototype.toString.call(m)};j.isDate=function i(m){return"[object RegExp]"==Object.prototype.toString.call(m)};return j})();c.CookiesUtil=d})(b.utils||(b.utils={}));var a=b.utils})(kurst||(kurst={}));var kurst;(function(a){(function(d){var c=(function(f){__extends(e,f);function e(){f.call(this);this.LOAD_SUCCESS=new a.event.Event("DataSender_loaded");this.LOAD_ERROR=new a.event.Event("DataSender_loadfailed");this.loader=new XMLHttpRequest()}e.prototype.sendData=function(h,i){if(!this.loader){this.loader=new XMLHttpRequest()}var g=this;this.loader.open("POST",h,true);this.loader.onload=function(j){g.onLoadComplete(j)};this.loader.onerror=function(j){g.onLoadError(j)};this.loader.responseType="text";this.loader.send(i)};e.prototype.getData=function(){return this.data};e.prototype.onLoadComplete=function(g){var i=g.currentTarget;try{this.data=i.responseText;this.dispatchEvent(this.LOAD_SUCCESS)}catch(h){this.data=i.responseText;this.dispatchEvent(this.LOAD_ERROR)}};e.prototype.onLoadError=function(g){var h=g.currentTarget;h.abort();this.dispatchEvent(this.LOAD_ERROR)};return e})(a.event.EventDispatcher);d.DataSender=c})(a.data||(a.data={}));var b=a.data})(kurst||(kurst={}));var apps;(function(b){(function(c){var d=(function(e){__extends(f,e);function f(){var g=this;e.call(this);this.debug=false;this.geoCookieName="GeoCookie_dataSent";this.IPGeoCoderKEY="3adfcad20627588be292388e8c0841afb958a2d63992e0d14b8de509b114b98a";this.detector=new kurst.threejs.Detector();if(this.detector.webgl){this.globe=new b.globe.GlobeView();this.ipGeoCoder=new kurst.data.IPGeoCoder(this.IPGeoCoderKEY);this.ipGeoCoder.addEventListener(this.ipGeoCoder.LOAD_ERROR.type,function(h){return g.onGeoCodeInfoLoadError()});this.ipGeoCoder.addEventListener(this.ipGeoCoder.LOAD_SUCCESS.type,function(h){return g.onGeoCodeInfoLoaded()});this.ipLoader=new kurst.data.DataLoader();this.ipLoader.addEventListener(this.ipLoader.LOAD_ERROR.type,function(h){return g.ipLoadFailed()});this.ipLoader.addEventListener(this.ipLoader.LOAD_SUCCESS.type,function(h){return g.ipLoaded()});this.ipLoader.loadData("getIP.php?"+String(Math.random()));this.ipGroupLoader=new kurst.data.DataLoader();this.ipGroupLoader.addEventListener(this.ipGroupLoader.LOAD_ERROR.type,function(h){return g.ipGroupDataLoadFailed()});this.ipGroupLoader.addEventListener(this.ipGroupLoader.LOAD_SUCCESS.type,function(h){return g.ipGroupDataLoaded()});this.ipGroupLoader.loadData("data.txt?"+String(Math.random()))}else{this.detector.addGetWebGLMessage()}}f.prototype.ipLoaded=function(){if(this.debug){this.ipGeoCoder.locateIP("81.97.40.44")}else{this.ipGeoCoder.locateIP(this.ipLoader.getData())}};f.prototype.onGeoCodeInfoLoaded=function(){var h=this.ipGeoCoder.getLocationData();this.ipSender=new kurst.data.DataSender();var g=new FormData();g.append("lat",String(h.latitude));g.append("long",String(h.longitude));g.append("country",String(h.countryName));g.append("city",String(h.cityName));this.ipSender.sendData("saveData.php",g);this.globe.addMarker(h)};f.prototype.ipGroupDataLoaded=function(){var h=this.ipGroupLoader.getData();var k=h.split("\n");var g=k.length;var i;var j=new kurst.data.GeoData();var m;for(var n=0;n<g;n++){m=k[n];i=m.split("|");j.longitude=i[0];j.latitude=i[1];j.countryName=i[2];j.cityName=i[3];this.globe.addMarker(j)}};f.prototype.onGeoCodeInfoLoadError=function(){};f.prototype.ipLoadFailed=function(){};f.prototype.ipGroupDataLoadFailed=function(){};return f})(kurst.core.UIBase);c.GlobeController=d})(b.controller||(b.controller={}));var a=b.controller})(apps||(apps={}));var Main;(function(b){var a;function c(){a=new apps.controller.GlobeController()}b.start=c})(Main||(Main={}));function onWindowLoad(a){Main.start()}function onWindowError(a){}window.onload=onWindowLoad;window.onerror=onWindowError;